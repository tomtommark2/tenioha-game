# プロジェクト引継ぎ資料 (To: Next AI Agent)

このファイルは、AIエージェントがチャットを切り替えた際に、プロジェクトの文脈（コンテキスト）を即座に把握するための資料です。
**次のAI担当者は、作業開始前に必ずこのファイルを読んでください。**

## 1. プロジェクト概要
*   **名称:** 英単語学習クリッカーゲーム (Vocab Clicker Game)
*   **目的:** クリッカーゲーム形式で英単語を学習できるWebアプリ。
*   **現状:** Web版としてGitHub Pagesで運用中。PWA対応済み。

## 2. 技術スタック & 構成
*   **構成:** **シングルHTML構成** (`vocab_clicker_game.html`)
    *   CSS, JavaScriptは全てこの1ファイル内に記述されています（保守性を考慮）。
    *   外部ファイルは `data/vocabulary.js` (単語データ), `service_worker.js`, `manifest.json`, `scripts/qrcode.min.js` のみ。
    *   `index.html` は `vocab_clicker_game.html` のコピーです（デプロイ用）。
*   **バックエンド:** Firebase
    *   **Firestore:** ユーザーデータ (`users`), ランキング (`leaderboard`), プロモコード (`promocodes`)
    *   **Auth:** Google認証
    *   **Analytics:** Google Analytics (v2.11以降稼働)

## 3. 重要な開発ルール（絶対遵守）
1.  **言語:** 会話、思考、計画はすべて **日本語** で行うこと。
2.  **デプロイ:** `vocab_clicker_game.html` を修正したら、必ず `index.html` にコピーし、GitHub (`git push`) へデプロイすること。
3.  **ユーザー体験:**
    *   **強制リロード禁止:** 更新が必要な場合でも、勝手にリロードせず、必ずダイアログ (`confirm` や Modal) でユーザーに同意を求めること。
    *   **デザイン:** モバイルファーストを意識。シンプルかつモダンなデザインを維持。

## 4. 現在のステータス (v2.13 - 2026/01/12)
### 実装済み機能
*   **音声再生の最適化 (v2.13):** PC版Chrome等での「スロー再生/遅延」バグを修正。AudioContextのKeep-Alive実装をOscillator(高負荷)からBuffer(軽量)に変更。
*   **半自動アップデート:** ランキング画面を開く際、`service_worker.js` のバージョン差異を検知し、更新ダイアログを表示する。
    *   これがないと、古いバージョンのままランキングにアクセスしデータ整合性が取れなくなるため重要。
*   **ヘルプ・シェア機能:** ヘルプ画面を刷新。SNSシェア機能、QRコード表示機能を実装済み。
*   **Google Analytics:** AdBlockユーザーが除外されることを考慮しつつ実装済み。

### 既知の仕様・注意点
*   **アプリ版のキャッシュ:** PWA（アプリ版）はキャッシュが強力で更新されにくいため、「ヘルプ画面」からの手動アップデートや、「ランキング時のバージョンチェック」が命綱となっている。
*   **Auth:** 未ログインユーザーも利用可能（ゲスト）。ランキングやクラウド保存時にログインを促す設計。

## 5. 現在の課題 / Next Steps
*   **チャットのパフォーマンス:** 長時間の作業でAIチャットが重くなる問題への対処（こまめなチャット移行の推奨）。
*   **データ整合性:** クラウド保存時、スコアが下がるような上書きを防ぐロジックが実装されている（コンフリクト解消）。

---
**Note to AI:**
このプロジェクトは「ユーザー体験」と「データの安全性」を最優先にしています。
コードを変更する際は、既存の動いているロジック（特にセーブデータ周りやバージョンチェック）を壊さないよう、細心の注意を払ってください。
